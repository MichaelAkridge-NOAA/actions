# `rstudio/actions/connect-publish`

This action may be use for publishing to RStudio Connect.

> **Important Note:** The only currently supported type of
> publishing is "from manifest". This type of publishing requires
> that a `manifest.json` has already been generated by either the R
> or Python `rsconnect` package, which may be done within an
> earlier GitHub Actions step or performed locally and stored in
> git.

## Inputs

### `url`

**Required** RStudio Connect URL of the instance to which content
will be published. The value of the URL may contain an [API key
genereted in RStudio
Connect](https://docs.rstudio.com/connect/__unreleased__/user/api-keys/)
(equivalent to the `api-key` input) in the "user" or "password"
part.

### `dir`

Directory or directories containing the content to publish,
optionally with `:<vanity-URL>` suffixes, separated by newlines.
Without a `:<vanity-URL>` suffix, the value of the directory path
will be used to match any existing published content. (Default
`"."`)

### `api-key`

An [API key genereted in RStudio
Connect](https://docs.rstudio.com/connect/__unreleased__/user/api-keys/).
This value may be included in `url` as the "user" or "password"
part. (No default)

### `access-type`

Access type to apply to published content. (No default)

Valid values are:

- `all`  publicly accessible
- `logged_in` accessible only when logged into RStudio Connect
- `acl` accessible to specific users and groups (managed within RStudio Connect)

When not specified, the RStudio Connect server configuration
default applies. Access types disallowed by RStudio Connect server
configuration will result in the publish being canceled.

### `namespace`

Namespace prefix for published paths. (No default)

This value is used in the construction of the "vanity URL" path,
e.g. this configuration:

```yaml
  - uses: rstudio/actions/connect-publish@main
    with:
      url: https://${{ secrets.RSTUDIO_CONNECT_API_KEY }}@connect.example.org
      namespace: experimental-beta
      dir: ./very-shiny-app/:/shiny/app/path/
```

will result in a published URL of

```
https://connect.example.org/experimental-beta/shiny/app/path/
```

> **NOTE** Because the namespace is used as the first segment of a
> slash-delimited path, there are restrictions on what is allowed
> by RStudio Connect. For example, a namespace of `connect` is not
> allowed and will result in an error at publish time.

### `show-logs`

Show all publishing logs. (Default `false`)

### `force`

Force publish even if up to date. (Default `false`)

> **NOTE**: The determination of a given publish being up to date
> is based on the bundle generated from the manifest matching the
> current bundle according to RStudio Connect. If available, the
> bundle SHA1 digest is compared, else the bundle size is compared.

## Outputs

### `results`

JSON-serialized array of objects, each containing a `dir`, `url`,
and `success` key indicating per-directory publish success. In case
of an unhandled error, the value will be an empty array.

## Example usage

```yaml
steps:
  - uses: actions/checkout@v2

  - name: Publish some things
    uses: rstudio/actions/connect-publish@main
    with:
      url: https://${{ secrets.RSTUDIO_CONNECT_API_KEY }}@connect.example.org
      access-type: logged_in
      dir: |
        ./very-shiny-app/:/shiny/app/path/
        ./useful-rmarkdown-report/:/reports/useful/
        ./slick-flask-api/
        ./insightful-jupyter-notebook/:/notebooks/insights/
```
